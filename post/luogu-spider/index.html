<!DOCTYPE html><html lang="cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>洛谷爬虫 - 宝硕博客</title><link rel="icon" href="https://blog.baoshuo.ren/favicon.ico"><link rel="preconnect" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://i.loli.net"><link rel="preconnect" href="https://vip1.loli.net"><link rel="preconnect" href="https://vip2.loli.net"><link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital@0;1&family=Open+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" as="style" onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"></noscript><link rel="alternate" href="/rss.xml" title="宝硕博客" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="宝硕博客" type="application/atom+xml"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/renbaoshuo/blog/styles/main.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-163290903-2"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-163290903-2")</script><script>document.addEventListener("DOMContentLoaded", (event) => {
        if((window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) || new Date().getHours() >= 19 || new Date().getHours() <= 6) {
            document.body.classList.add("night");
        }
    });</script><script>document.addEventListener("DOMContentLoaded", (event) => {
            document.querySelectorAll('h2, h3, h4, h5').forEach((element) => {
                element.innerHTML = `<a id="anchor-${element.id}" class="anchor" style="color: var(--content-second) !important;" href="#${element.id}" aria-hidden="true"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" fill="currentColor" d="M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z"></path></svg></a>${element.innerHTML}`;
            });
        });</script><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@renbaoshuo"><meta property="og:site_name" content="宝硕博客"><meta property="og:title" content="洛谷爬虫 - 宝硕博客"><meta property="og:url" content="https://blog.baoshuo.ren/post/luogu-spider/"><meta property="og:description" content="截至目前，洛谷已经有了近两万道题目和四十余万名用户。本代码爬取了一些样本，以供后续（可能）的数据分析。"><meta property="og:image" content="https://blog.baoshuo.ren/favicon.png"><meta name="keywords" content="宝硕博客,"><meta name="description" content="截至目前，洛谷已经有了近两万道题目和四十余万名用户。本代码爬取了一些样本，以供后续（可能）的数据分析。"><meta name="generator" content="Hexo 5.3.0"></head><body><div class="main gt-bg-theme-color-first"><div class="main-content"><a class="skip-link" href="#main">Skip to main</a><nav class="navbar navbar-expand-lg"><div class="navbar-brand"><a href="/"><div style="height:70px;margin-bottom:-23px;margin-top:-23px" class="gt-c-content-color-first"><svg width="180" height="69" xmlns="http://www.w3.org/2000/svg"><metadata id="metadata25">image/svg+xml</metadata><g><title>background</title><rect x="-1" y="-1" width="182" height="71" id="canvas_background" fill="none"/></g><g><title>Layer 1</title><g stroke="null" id="id__12589826"><g stroke="null" id="text2" fill="currentColor" font-family="IDPinocchio" font-size="40px"><path stroke="null" id="path27" d="m40.502113,45.691685l2.958147,0q0.570245,0 0.641526,0.580326l0.03564,2.430117q0,0.253893 -0.178202,0.435245q-0.142561,0.181352 -0.427684,0.181352l-23.843379,0.616597q-0.249482,0 -0.427684,-0.181352q-0.178202,-0.145082 -0.178202,-0.398974l-0.071281,-3.082984q0,-0.253893 0.178202,-0.435245q0.178202,-0.181352 0.427684,-0.181352l9.195205,0.03627l0.106921,-4.098555l-7.62703,0q-0.249482,0 -0.427684,-0.145082q-0.178202,-0.181352 -0.178202,-0.471515l-0.03564,-2.72028q-0.03564,-0.253893 0.142561,-0.435245q0.178202,-0.181352 0.427684,-0.181352l7.769591,-0.181352l0.071281,-3.191795l-8.589319,0.326434q-0.249482,0.03627 -0.427684,-0.108811q-0.178202,-0.181352 -0.178202,-0.471515l-0.142561,-3.119254q0,-0.253893 0.142561,-0.435245q0.178202,-0.181352 0.463324,-0.181352l21.990082,-0.072541q0.570245,0 0.641526,0.580326l0.071281,2.357576q0.03564,0.253893 -0.142561,0.435245q-0.178202,0.181352 -0.427684,0.181352l-8.838801,0.326434l0.106921,3.228065l7.947793,-0.217622q0.249482,0 0.427684,0.181352q0.178202,0.145082 0.178202,0.398974l0.03564,3.264336q0,0.616597 -0.570245,0.616597l-2.637384,0.03627l2.387902,2.285035q0.249482,0.253893 0.249482,0.580326q0,0.290163 -0.285123,0.471515l-0.962289,0.761678zm-0.285123,-16.684382q-0.285123,0 -0.463324,-0.217622q-0.178202,-0.253893 -0.106921,-0.580326l0.249482,-1.051842q0.071281,-0.326434 -0.106921,-0.544056q-0.142561,-0.253893 -0.427684,-0.217622l-15.325341,0.544056q-0.285123,0.03627 -0.463324,0.290163q-0.178202,0.217622 -0.142561,0.544056l0.071281,0.761678q0.071281,0.326434 -0.142561,0.580326q-0.178202,0.217622 -0.463324,0.217622l-4.134278,0q-0.285123,0 -0.498965,-0.217622q-0.213842,-0.253893 -0.178202,-0.580326l0.285123,-4.642611q0.03564,-0.326434 0.249482,-0.544056q0.213842,-0.253893 0.498965,-0.253893l9.480327,0l-1.176131,-2.103683q-0.178202,-0.290163 -0.071281,-0.616597q0.106921,-0.326434 0.392044,-0.507786l1.746376,-1.160653q0.285123,-0.181352 0.641526,-0.108811q0.356403,0.072541 0.605886,0.326434l3.528392,3.264336q0.392044,0.471515 0.03564,0.90676l9.159564,-0.03627q0.285123,0 0.498965,0.253893q0.249482,0.217622 0.285123,0.544056l0.392044,4.424988q0.03564,0.326434 -0.178202,0.580326q-0.178202,0.217622 -0.498965,0.217622l-3.742234,-0.072541zm-3.956076,14.435618q-0.178202,-0.290163 -0.142561,-0.616597q0.071281,-0.362704 0.356403,-0.544056l1.03357,-0.689138l-3.635313,0l0.142561,4.098555l3.635313,0l-1.389973,-2.248765z" fill="currentColor"/></g><g stroke="null" id="text4" fill="currentColor" font-family="IDPinocchio" font-size="40px"><path stroke="null" id="path30" d="m67.744688,46.888608q0,0.290163 -0.213842,0.435245q-0.178202,0.181352 -0.463324,0.181352l-7.128066,0.072541q-0.285123,-0.03627 -0.463324,-0.217622q-0.178202,-0.181352 -0.178202,-0.435245l-0.178202,-9.720466l-1.247411,1.559627q-0.178202,0.181352 -0.463324,0.217622q-0.249482,0 -0.463324,-0.217622l-2.245341,-1.668438q-0.213842,-0.181352 -0.213842,-0.435245q0,-0.253893 0.178202,-0.471515q1.354332,-1.668438 2.316621,-3.119254q0.962289,-1.487086 1.639455,-2.865361q0.677166,-1.378275 1.10485,-2.684009q0.463324,-1.305734 0.748447,-2.684009l-2.530463,0.181352q-0.677166,0 -0.677166,-0.689138l-0.071281,-2.865361q0,-0.290163 0.213842,-0.471515q0.213842,-0.181352 0.498965,-0.181352l9.337766,0.108811q0.285123,0 0.463324,0.217622q0.178202,0.181352 0.178202,0.471515l0.03564,2.103683q0,0.290163 -0.213842,0.471515q-0.213842,0.181352 -0.498965,0.181352l-2.922507,0.217622q-0.249482,1.487086 -0.641526,3.010443q-0.356403,1.487086 -0.962289,3.119254l4.811444,-0.108811q0.285123,-0.03627 0.463324,0.145082q0.178202,0.181352 0.142561,0.471515l-0.356403,15.668811zm16.644033,-5.47683q0,0.507786 -0.570245,0.507786l-3.029428,0q-0.249482,0 -0.392044,-0.145082q-0.142561,-0.181352 -0.142561,-0.398974l0.392044,-10.699767q0.03564,-0.217622 -0.213842,-0.362704q-0.249482,-0.145082 -0.498965,-0.108811l-6.700382,0.290163q-0.498965,0.072541 -0.427684,0.580326l0.285123,10.373333q0.03564,0.253893 -0.142561,0.398974q-0.142561,0.145082 -0.392044,0.145082l-2.993788,0q-0.570245,0 -0.570245,-0.544056l0.463324,-13.528858q0,-0.217622 0.142561,-0.362704q0.178202,-0.181352 0.427684,-0.181352l4.775804,-0.03627q-0.106921,-0.181352 -0.03564,-0.471515l0.570245,-2.72028l-5.346049,0.253893q-0.285123,0 -0.463324,-0.217622q-0.178202,-0.253893 -0.178202,-0.544056l-0.03564,-2.611469q0,-0.290163 0.178202,-0.471515q0.213842,-0.217622 0.498965,-0.181352l14.14921,0.03627q0.285123,0 0.427684,0.253893q0.178202,0.217622 0.178202,0.507786l0.03564,1.84979q0,0.290163 -0.285123,0.507786q-0.285123,0.217622 -0.570245,0.217622l-5.167848,0.253893l-0.392044,3.300606l5.132207,-0.072541q0.213842,0 0.356403,0.145082q0.178202,0.145082 0.178202,0.362704l0.356403,13.67394zm-6.664741,-10.300793q0.570245,0.072541 0.570245,0.652867q0,2.538928 0.03564,4.461259q0.03564,1.922331 -0.071281,3.481958q-0.106921,1.559627 -0.427684,2.792821q-0.320763,1.233193 -1.03357,2.393846q-0.712807,1.160653 -1.924578,2.321305q-1.176131,1.124382 -2.993788,2.430117q-0.712807,0.507786 -1.14049,0l-1.995858,-2.430117q-0.178202,-0.181352 -0.142561,-0.435245q0.03564,-0.290163 0.356403,-0.471515q1.425613,-0.834219 2.423542,-1.559627q0.997929,-0.761678 1.639455,-1.595897q0.641526,-0.834219 0.962289,-1.81352q0.356403,-1.015571 0.498965,-2.321305q0.178202,-1.342005 0.178202,-3.082984q0.03564,-1.777249 0.03564,-4.134825q0,-0.290163 0.178202,-0.507786q0.178202,-0.217622 0.427684,-0.217622l2.423542,0.03627zm5.773733,18.461632q-0.213842,0.253893 -0.498965,0.253893q-0.285123,0.03627 -0.498965,-0.181352l-4.811444,-4.787692q-0.213842,-0.253893 -0.213842,-0.580326q0,-0.326434 0.178202,-0.544056l1.176131,-1.378275q0.213842,-0.253893 0.534605,-0.253893q0.320763,-0.03627 0.570245,0.145082l5.203488,4.134825q0.285123,0.181352 0.285123,0.507786q0.03564,0.290163 -0.142561,0.507786l-1.782016,2.176224zm-19.56654,-4.316177q0.249482,0 0.427684,-0.181352q0.178202,-0.181352 0.213842,-0.471515l0,-10.808578q0,-0.616597 -0.605886,-0.544056l-0.784087,0q-0.285123,0.03627 -0.463324,0.181352q-0.178202,0.145082 -0.178202,0.435245l-0.03564,10.772308q0,0.290163 0.178202,0.471515q0.178202,0.181352 0.463324,0.181352l0.784087,-0.03627z" fill="currentColor"/></g><g stroke="null" id="text6" fill="currentColor" font-family="IDPinocchio" font-size="40px"><path stroke="null" id="path33" d="m105.109117,23.276579q0,-0.544056 0.570245,-0.616597l6.201417,-0.108811l-0.03564,-2.103683q0,-0.471515 0.463324,-0.471515l3.24327,0.03627q0.463324,0 0.463324,0.471515l-0.071281,1.958601l1.176131,0l-0.356403,-1.233193q-0.178202,-0.580326 0.392044,-0.797949l1.318692,-0.544056q0.285123,-0.108811 0.534605,0q0.249482,0.072541 0.392044,0.326434l1.568174,2.139953l1.496894,-0.03627q0.498965,-0.03627 0.570245,0.471515l0.071281,2.647739q0,0.544056 -0.534605,0.544056l-6.700382,-0.03627l-0.03564,1.051842l5.809373,-0.072541q0.285123,-0.03627 0.463324,0.181352q0.178202,0.181352 0.178202,0.471515l0.178202,10.98993q0,0.616597 -0.534605,0.616597l-2.922507,0.03627q-0.534605,-0.03627 -0.534605,-0.616597l0,-0.326434l-2.886867,-0.03627l0,1.088112q0,0.471515 -0.498965,0.471515l-2.387902,0.03627q-0.427684,0 -0.498965,-0.507786l-0.03564,-1.160653l-3.20763,-0.072541l0.03564,0.471515q0.03564,0.544056 -0.534605,0.544056l-2.779946,0q-0.570245,0 -0.570245,-0.689138l0.320763,-10.627226q0,-0.290163 0.178202,-0.471515q0.178202,-0.181352 0.463324,-0.181352l5.880654,-0.072541l0,-1.160653l-6.130136,-0.03627q-0.570245,0 -0.641526,-0.580326l-0.071281,-1.994872zm-2.459183,7.653054l0.320763,18.098928q0.03564,0.290163 -0.142561,0.471515q-0.178202,0.181352 -0.427684,0.181352l-3.492752,0.03627q-0.249482,0 -0.427684,-0.181352q-0.142561,-0.181352 -0.142561,-0.471515l0.213842,-17.772494l-1.746376,0.145082q-0.285123,0.03627 -0.498965,-0.181352q-0.178202,-0.217622 -0.178202,-0.507786l0,-2.538928q0,-0.290163 0.178202,-0.507786q0.213842,-0.217622 0.498965,-0.217622l1.782016,0.03627l0.106921,-6.927646q0,-0.290163 0.178202,-0.435245q0.178202,-0.181352 0.427684,-0.181352l2.637384,0q0.249482,0 0.392044,0.181352q0.178202,0.181352 0.178202,0.471515l0.106921,6.891375l1.03357,0q0.285123,0 0.463324,0.217622q0.213842,0.217622 0.213842,0.507786l0.071281,1.81352q0,0.290163 -0.213842,0.544056q-0.178202,0.217622 -0.463324,0.217622l-1.06921,0.108811zm16.608393,8.305921q0.570245,0 0.641526,0.580326q0,0.362704 0.03564,0.544056l3.136349,-0.072541q0.534605,-0.03627 0.534605,0.471515l0,2.393846q0,0.544056 -0.534605,0.544056l-2.993788,0q0.071281,1.414545 0.071281,2.865361q0.03564,1.450816 0.03564,2.72028q-0.03564,0.725408 -0.534605,0.725408l-3.670954,-0.03627q-0.534605,0 -0.427684,-0.761678q0.178202,-1.269464 0.320763,-2.72028q0.178202,-1.450816 0.285123,-2.829091l-11.618747,-0.108811q-0.249482,0 -0.427684,-0.145082q-0.178202,-0.181352 -0.213842,-0.398974l-0.071281,-1.740979q0,-0.580326 0.570245,-0.580326l11.97515,-0.253893l0,-0.471515q0,-0.689138 0.534605,-0.689138l2.352262,-0.03627zm-6.664741,9.756737q-0.106921,0.217622 -0.356403,0.290163q-0.213842,0.072541 -0.427684,-0.108811l-4.704523,-2.901632q-0.463324,-0.362704 -0.142561,-0.87049l0.641526,-1.088112q0.320763,-0.507786 0.784087,-0.290163l5.310409,1.632168q0.249482,0.072541 0.285123,0.290163q0.071281,0.217622 -0.071281,0.471515l-1.318692,2.575198zm-3.350191,-18.715525q-0.534605,0.03627 -0.463324,0.616597l0,0.616597l3.24327,-0.072541l0,-1.160653l-2.779946,0zm-0.356403,4.969044l3.20763,-0.03627l0,-1.015571l-3.24327,-0.072541l0.03564,1.124382zm6.878583,-5.005315l0,1.088112l3.171989,-0.072541l0.03564,-0.471515q0.071281,-0.652867 -0.498965,-0.580326l-2.708665,0.03627zm-0.106921,4.932774l3.029428,-0.03627l0.03564,-0.834219l-3.029428,-0.072541l-0.03564,0.94303z" fill="currentColor"/></g><g stroke="null" id="text8" fill="currentColor" font-family="IDPinocchio" font-size="40px"><path stroke="null" id="path36" d="m136.842374,37.276953q0.03564,0 0.142561,-0.03627q0.071281,-0.03627 0.178202,-0.03627q0.106921,-0.03627 0.285123,-0.108811q4.134278,-1.124382 7.769591,-2.321305q-0.819728,-0.471515 -1.532534,-0.94303q-0.677166,-0.507786 -1.211771,-1.015571q-0.784087,0.580326 -1.568174,1.088112q-0.748447,0.471515 -1.496894,0.87049q-0.498965,0.253893 -0.784087,-0.253893l-0.962289,-1.704709q-0.320763,-0.507786 0.106921,-0.797949q0.784087,-0.544056 1.746376,-1.342005q0.997929,-0.797949 1.995858,-1.668438q0.997929,-0.90676 1.888937,-1.81352q0.926649,-0.90676 1.603815,-1.704709l-2.815586,0.072541q-0.285123,0 -0.498965,0.217622q-0.178202,0.181352 -0.142561,0.435245l0.106921,1.450816q0.03564,0.290163 -0.142561,0.471515q-0.178202,0.181352 -0.498965,0.181352l-3.777875,0q-0.285123,0 -0.498965,-0.181352q-0.178202,-0.181352 -0.178202,-0.471515l0.285123,-4.932774q0.03564,-0.253893 0.249482,-0.435245q0.213842,-0.181352 0.498965,-0.181352l9.337766,0l-1.10485,-1.81352q-0.178202,-0.290163 -0.071281,-0.580326q0.106921,-0.326434 0.392044,-0.507786l1.746376,-1.124382q0.285123,-0.145082 0.641526,-0.072541q0.356403,0.03627 0.605886,0.290163l3.492752,2.865361q0.427684,0.507786 0,0.94303l8.910082,-0.03627q0.285123,0 0.498965,0.181352q0.249482,0.181352 0.249482,0.471515l0.392044,4.932774q0.03564,0.290163 -0.178202,0.471515q-0.178202,0.181352 -0.463324,0.181352l-3.635313,-0.03627l1.10485,2.067413q0.142561,0.290163 0.106921,0.689138q-0.03564,0.398974 -0.392044,0.761678q-0.819728,0.834219 -1.888937,1.595897q-1.03357,0.725408 -2.280981,1.450816q1.782016,0.507786 3.457112,0.87049q1.710736,0.362704 3.136349,0.544056q0.249482,0.03627 0.463324,0.072541q0.249482,0 0.427684,0.03627q0.213842,0.03627 0.392044,0.03627q0.570245,0.108811 0.463324,0.689138l-0.997929,3.373147q-0.142561,0.580326 -0.748447,0.471515q-0.106921,0 -0.249482,-0.03627q-0.106921,-0.03627 -0.285123,-0.072541q-0.178202,-0.03627 -0.356403,-0.108811l-1.14049,-0.290163q0.03564,0.108811 0.03564,0.290163l-0.534605,8.160839q-0.03564,0.290163 -0.285123,0.507786q-0.213842,0.217622 -0.498965,0.217622l-16.893515,0q-0.320763,0 -0.534605,-0.217622q-0.213842,-0.217622 -0.249482,-0.507786l-0.534605,-7.616783l0,-0.217622q-0.178202,0.072541 -0.392044,0.145082q-0.178202,0.03627 -0.356403,0.108811q-0.178202,0.072541 -0.320763,0.145082q-0.142561,0.03627 -0.249482,0.072541q-0.142561,0.072541 -0.249482,0.072541q-0.249482,0.072541 -0.498965,-0.03627q-0.249482,-0.108811 -0.320763,-0.362704l-1.247411,-3.119254q-0.106921,-0.253893 -0.03564,-0.471515q0.106921,-0.253893 0.392044,-0.326434zm17.927085,8.813706q0.285123,-0.03627 0.498965,-0.253893q0.213842,-0.217622 0.213842,-0.507786l0.03564,-1.559627q0,-0.290163 -0.213842,-0.507786q-0.178202,-0.217622 -0.498965,-0.181352l-9.80109,0.652867q-0.285123,0 -0.498965,0.253893q-0.213842,0.217622 -0.213842,0.507786l-0.071281,1.559627q0,0.290163 0.213842,0.507786q0.213842,0.217622 0.498965,0.181352l9.836731,-0.652867zm-6.700382,-19.295851q0.392044,0.398974 0.071281,0.834219l-0.106921,0.145082l9.052643,-0.217622q0.463324,0 0.641526,0.072541l0.213842,-1.84979q0.071281,-0.253893 -0.106921,-0.435245q-0.178202,-0.181352 -0.463324,-0.181352l-10.8703,0.290163l1.568174,1.342005zm10.157493,13.274965q-1.817657,-0.544056 -3.884796,-1.269464q-2.067139,-0.725408 -4.098638,-1.559627q-2.102779,0.94303 -4.241199,1.740979q-2.13842,0.797949 -4.169918,1.523357l16.394551,-0.435245zm-12.260273,-8.487273q1.639455,0.797949 3.706594,1.559627q1.746376,-0.725408 3.065068,-1.414545q1.318692,-0.725408 2.067139,-1.414545l-8.838801,1.269464zm-1.14049,-0.652867l0.03564,0l-0.03564,0z" fill="currentColor"/></g><path stroke="currentColor" id="line10" d="m9.25,38.297057l0,-28.109557" stroke-width="2"/><path stroke="currentColor" id="line12" d="m9.25,11.09426l26.730246,0" stroke-width="2"/><path stroke="currentColor" id="line14" d="m172.750004,30.702943l0,28.109557" stroke-width="2"/><path stroke="currentColor" id="line16" d="m172.750004,57.905741l-26.730246,0" stroke-width="2"/></g></g></svg></div></a></div><div class="collapse navbar-collapse" id="navbarSupportedContent"><div class="navbar-nav mr-auto" style="text-align:center"><div class="nav-item"><a href="/" class="menu gt-a-link">首页</a></div><div class="nav-item"><a href="/archives/" class="menu gt-a-link">归档</a></div><div class="nav-item"><a href="/tags/" class="menu gt-a-link">标签</a></div><div class="nav-item"><a href="/friends/" class="menu gt-a-link">友链</a></div><div class="nav-item"><a href="/about/" class="menu gt-a-link">关于</a></div></div></div><button aria-label="Navbar Toggler" class="navbar-toggler" type="button" id="changeNavbar"><i class="gt-c-content-color-first" style="font-size:18px"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" height="18px" fill="currentColor"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></i></button></nav><script>/* 移动端导航栏展开/收起切换 */
    document.getElementById('changeNavbar').onclick = function() {
        let element = document.getElementById('navbarSupportedContent');
        if (element.style.display === 'none' || element.style.display === '') {
            element.style.display = 'block';
        } else { 
            element.style.display = 'none';
        }
    }</script><div class="post-container"><div class="post-detail gt-bg-theme-color-second gt-c-content-color-first"><article class="gt-post-content" id="main"><h1 class="post-title">洛谷爬虫</h1><div class="post-info"><time class="post-time gt-c-content-color-first">· 2020 年 11 月 26 日 ·</time> <a href="/tags/%E6%8A%98%E8%85%BE/" class="post-tag">#折腾</a></div><hr><div class="post-content gt-c-content-color-first"><p>截至目前，洛谷已经有了近两万道题目和四十余万名用户。本代码爬取了一些样本，以供后续（可能）的数据分析。</p><a id="more"></a><p>本次爬取遵守洛谷的 <code>robots.txt</code> 中的要求，不爬取提交记录页面。为了避免影响洛谷的正常运行，脚本只采用单线程进行爬取。</p><pre><code class="hljs groovy">User-<span class="hljs-attr">Agent:</span> *
<span class="hljs-attr">Disallow:</span> /record
<span class="hljs-attr">Disallow:</span> /recordnew</code></pre><h2 id="爬取题目信息"><a class="header-anchor" href="#爬取题目信息"></a>爬取题目信息</h2><h3 id="题目数据获取"><a class="header-anchor" href="#题目数据获取"></a>题目数据获取</h3><p>先使用 <code>curl</code> 获取洛谷的题目页面：</p><p><img src="https://vip1.loli.net/2020/11/26/JageUdcpXTthIjM.png" alt="" loading="lazy"></p><p>可以看出我们需要的数据都在传入给 <code>decodeURIComponent()</code> 函数的字符串中，正则匹配取出即可。</p><p>下面是代码实现：</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># coding: utf-8</span>

<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> unquote

<span class="hljs-comment"># 设置请求头</span>
headers = &#123;
    <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36 Spider/0.1&quot;</span>
&#125;

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getProblemJSON</span>(<span class="hljs-params">pid</span>):</span>
    <span class="hljs-keyword">return</span> json.loads(unquote(<span class="hljs-built_in">str</span>(re.findall(<span class="hljs-string">r&#x27;decodeURIComponent\(&quot;(.*)&quot;\)&#x27;</span>, requests.get(url=<span class="hljs-string">&quot;https://www.luogu.com.cn/problem/P1000&quot;</span>, headers=headers).text)[<span class="hljs-number">0</span>])))

data = getProblemJSON(<span class="hljs-string">&quot;P1000&quot;</span>)
print(json.dumps(data[<span class="hljs-string">&#x27;currentData&#x27;</span>], sort_keys=<span class="hljs-literal">True</span>, indent=<span class="hljs-number">4</span>))</code></pre><div class="scode warn"><p class="scode-title">Update at 2021/02/05</p><p>添加参数 <code>_contentOnly=1</code> 可以直接获取JSON格式的信息，无需再正则匹配。</p><pre><code class="hljs diff"><span class="hljs-comment">--- a/tools/spider.py</span>
<span class="hljs-comment">+++ b/tools/spider.py</span>
<span class="hljs-meta">@@ -19,8 +19,7 @@</span>
 def getProblem(pid):
<span class="hljs-deletion">-    url = f&quot;https://www.luogu.com.cn/problem/&#123;pid&#125;&quot;</span>
<span class="hljs-deletion">-    redata = re.findall(r&#x27;decodeURIComponent\(&quot;(.*)&quot;\)&#x27;,</span>
<span class="hljs-deletion">-                        requests.get(url, headers=headers).text)</span>
<span class="hljs-addition">+    url = f&quot;https://www.luogu.com.cn/problem/&#123;pid&#125;?_contentOnly=1&quot;</span>
<span class="hljs-addition">+    redata = requests.get(url, headers=headers).text</span>
     if len(redata) == 0:
         return &#123; &quot;code&quot;: 403 &#125;
     else:
<span class="hljs-deletion">-        return json.loads(unquote(redata[0]))</span>
<span class="hljs-addition">+        return json.loads(redata)</span></code></pre></div><h3 id="处理题目数据"><a class="header-anchor" href="#处理题目数据"></a>处理题目数据</h3><p>这里只留下 <code>currentData.problem</code> 字段里面的内容即可。</p><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># coding: utf-8</span>

<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> re
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> unquote

f = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;problems.json&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>)
res = []

headers = &#123;
    <span class="hljs-string">&quot;user-agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4331.0 Safari/537.36 spider/0.1&quot;</span>,
&#125;


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getProblem</span>(<span class="hljs-params">pid</span>):</span>
    <span class="hljs-keyword">return</span> json.loads(requests.get(<span class="hljs-string">f&quot;https://www.luogu.com.cn/problem/<span class="hljs-subst">&#123;pid&#125;</span>?_contentOnly=1&quot;</span>, headers=headers).text)[<span class="hljs-string">&#x27;currentData&#x27;</span>]


<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">1010</span>):
    tmpdict = &#123;&#125;
    tmpdict[<span class="hljs-string">&quot;pid&quot;</span>] = <span class="hljs-string">f&quot;P<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>
    tmpdict[<span class="hljs-string">&quot;data&quot;</span>] = getProblem(<span class="hljs-string">f&quot;P<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>)[<span class="hljs-string">&quot;problem&quot;</span>]
    res.append(tmpdict)

<span class="hljs-comment"># print(res)</span>
f.write(json.dumps(res, indent=<span class="hljs-number">4</span>).replace(<span class="hljs-string">&quot;\\t&quot;</span>, <span class="hljs-string">&quot;    &quot;</span>))</code></pre><h3 id="最终代码"><a class="header-anchor" href="#最终代码"></a>最终代码</h3><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python3</span>
<span class="hljs-comment"># coding: utf-8</span>

<span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> pymongo

dbclient = pymongo.MongoClient(<span class="hljs-string">&quot;mongodb://127.0.0.1:27017/&quot;</span>)
luogudb = dbclient[<span class="hljs-string">&quot;luogu&quot;</span>]
dbcol = luogudb[<span class="hljs-string">&quot;problem&quot;</span>]

headers = &#123;
    <span class="hljs-string">&quot;user-agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4331.0 Safari/537.36 spider/0.1&quot;</span>,
&#125;


<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getProblem</span>(<span class="hljs-params">pid</span>):</span>
    url = <span class="hljs-string">f&quot;https://www.luogu.com.cn/problem/<span class="hljs-subst">&#123;pid&#125;</span>?_contentOnly=1&quot;</span>
    redata = requests.get(url, headers=headers).text
    <span class="hljs-keyword">return</span> json.loads(redata)

<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">7103</span>):
    pid = <span class="hljs-string">f&quot;P<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">list</span>(dbcol.find(&#123;<span class="hljs-string">&#x27;pid&#x27;</span>: pid&#125;)) == []:
        tmpdict = &#123;&#125;
        tmpdict[<span class="hljs-string">&quot;pid&quot;</span>] = pid
        tmpdata = getProblem(pid)
        <span class="hljs-keyword">if</span> tmpdata[<span class="hljs-string">&quot;code&quot;</span>] == <span class="hljs-number">200</span>:
            tmpdict[<span class="hljs-string">&quot;data&quot;</span>] = getProblem(pid)[<span class="hljs-string">&quot;currentData&quot;</span>][<span class="hljs-string">&quot;problem&quot;</span>]
            dbcol.insert_one(tmpdict)
            print(<span class="hljs-string">f&quot;Successfully get problem <span class="hljs-subst">&#123;pid&#125;</span>.&quot;</span>)
            time.sleep(<span class="hljs-number">1</span>)
        <span class="hljs-keyword">else</span>:
            print(<span class="hljs-string">f&quot;Fail to get problem <span class="hljs-subst">&#123;pid&#125;</span>.&quot;</span>)
    <span class="hljs-keyword">else</span>:
        print(<span class="hljs-string">f&quot;Problem <span class="hljs-subst">&#123;pid&#125;</span> is already exists.&quot;</span>)</code></pre><p>有关于数据库读写的部分请参考下文的 <a href="#%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a> 部分。</p><h2 id="爬取用户信息"><a class="header-anchor" href="#爬取用户信息"></a>爬取用户信息</h2><p>结构与题目爬虫类似，故不再作代码说明。</p><pre><code class="hljs python"><span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> pymongo
<span class="hljs-keyword">import</span> requests

dbclient = pymongo.MongoClient(<span class="hljs-string">&quot;mongodb://127.0.0.1:27017/&quot;</span>)
luogudb = dbclient[<span class="hljs-string">&quot;luogu&quot;</span>]
dbcol = luogudb[<span class="hljs-string">&quot;user&quot;</span>]

headers = &#123; <span class="hljs-string">&quot;User-Agent&quot;</span>: <span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4331.0 Safari/537.36&quot;</span>, &#125;

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getUser</span>(<span class="hljs-params">uid</span>):</span>
    url = <span class="hljs-string">f&quot;https://www.luogu.com.cn/user/<span class="hljs-subst">&#123;uid&#125;</span>?_contentOnly=1&quot;</span>
    redata = requests.get(url, headers=headers).text
    <span class="hljs-keyword">return</span> json.loads(redata)

<span class="hljs-keyword">for</span> uid <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>):
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">list</span>(dbcol.find(&#123;<span class="hljs-string">&#x27;uid&#x27;</span>: uid&#125;)) == []:
        tmpdict = &#123;&#125;
        tmpdict[<span class="hljs-string">&quot;_id&quot;</span>] = uid
        tmpdict[<span class="hljs-string">&quot;uid&quot;</span>] = uid
        tmpdata = getUser(uid)
        <span class="hljs-keyword">if</span> tmpdata[<span class="hljs-string">&quot;code&quot;</span>] == <span class="hljs-number">200</span>:
            tmpdict[<span class="hljs-string">&quot;data&quot;</span>] = tmpdata[<span class="hljs-string">&quot;currentData&quot;</span>][<span class="hljs-string">&quot;user&quot;</span>]
            dbcol.insert_one(tmpdict)
            print(<span class="hljs-string">f&quot;Successfully get user <span class="hljs-subst">&#123;uid&#125;</span>.&quot;</span>)
            time.sleep(<span class="hljs-number">0.5</span>)
        <span class="hljs-keyword">else</span>:
            print(<span class="hljs-string">f&quot;Fail to get user <span class="hljs-subst">&#123;uid&#125;</span>.&quot;</span>)
            time.sleep(<span class="hljs-number">0.5</span>)
    <span class="hljs-keyword">else</span>:
        print(<span class="hljs-string">f&quot;User <span class="hljs-subst">&#123;uid&#125;</span> is already exists.&quot;</span>)</code></pre><h2 id="数据库"><a class="header-anchor" href="#数据库"></a>数据库</h2><h3 id="搭建数据库"><a class="header-anchor" href="#搭建数据库"></a>搭建数据库</h3><p>搭建 MongoDB 数据库只需要在 docker 里面跑一个容器，非常简便。</p><pre><code class="hljs bash">docker run -v /root/data/mongo:/data/db -itd --name mongo -p 27017:27017 mongo</code></pre><h3 id="连接数据库"><a class="header-anchor" href="#连接数据库"></a>连接数据库</h3><pre><code class="hljs python">client = pymongo.MongoClient(<span class="hljs-string">&quot;mongodb://127.0.0.1:27017/&quot;</span>)
luogudb = dbclient[<span class="hljs-string">&quot;luogu&quot;</span>]
col = luogudb[<span class="hljs-string">&quot;problem&quot;</span>]</code></pre><h3 id="存储数据"><a class="header-anchor" href="#存储数据"></a>存储数据</h3><pre><code class="hljs python"><span class="hljs-keyword">if</span> <span class="hljs-built_in">list</span>(col.find(&#123;<span class="hljs-string">&#x27;pid&#x27;</span> : pid&#125;)) == []:
    col.insert_one(data)
    print(<span class="hljs-string">&quot;Success.&quot;</span>)
<span class="hljs-keyword">else</span>:
    print(<span class="hljs-string">&quot;Already exists.&quot;</span>)</code></pre><h3 id="读取数据"><a class="header-anchor" href="#读取数据"></a>读取数据</h3><pre><code class="hljs python">print(<span class="hljs-built_in">list</span>(col.find()))</code></pre><h2 id="web-管理数据库"><a class="header-anchor" href="#web-管理数据库"></a>web 管理数据库</h2><p>再跑一个 <code>mongo-express</code> 就行了。</p><pre><code class="hljs bash">docker run -d --name mongo-express -e ME_CONFIG_MONGODB_SERVER=host.docker.internal -p 8081:8081 mongo-express</code></pre><p>访问 <code>ip:8081</code> 就能看到管理界面了。</p><h2 id="导出数据库"><a class="header-anchor" href="#导出数据库"></a>导出数据库</h2><p>直接运行下方命令导出为 JSON 格式即可。</p><pre><code class="hljs bash">mongoexport -d luogu -c problem -o /data/db/problem.json</code></pre><p>或者点击对应数据库管理界面中的 <code>[JSON]</code> 按钮导出。</p><p><img src="https://vip2.loli.net/2020/11/26/hXtVAynYGcb8B71.png" alt="" loading="lazy"></p><h2 id="成果"><a class="header-anchor" href="#成果"></a>成果</h2><p>断断续续爬了一个多星期，终于爬完了。</p><p><img src="https://vip1.loli.net/2020/11/26/7muojQZM125gWXL.png" alt="" loading="lazy"></p></div></article></div><div class="copyright gt-bg-theme-color-second gt-c-content-color-first"><ul class="post-copyright"><li class="post-copyright-author"><b>本文作者：</b> 宝硕</li><li class="post-copyright-link"><b>本文链接：</b> <a href="https://blog.baoshuo.ren/post/luogu-spider/" title="洛谷爬虫">https://blog.baoshuo.ren/post/luogu-spider/</a></li><li class="post-copyright-license"><b>版权声明：</b> 本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处。</li></ul></div><div class="afdian gt-bg-theme-color-second gt-c-content-color-first"><div class="donation-label">喜欢这篇文章？为什么不考虑打赏一下作者呢？</div><a class="afdian-button button" href="https://afdian.net/@baoshuo" rel="nofollow noopener" target="_blank">爱发电</a></div><div class="next-prev-post"><div class="prev-post"><div class="prev gt-c-content-color-first">上一篇：<a href="/post/download-smms-image/" class="post-title gt-a-link">【随笔】下载自己在 SM.MS 图床上的所有图片</a></div></div><div class="next-post"><div class="next gt-c-content-color-first">下一篇：<a href="/post/change-git-submission-email/" class="post-title gt-a-link">【随笔】批量修改 Git 仓库的提交邮箱</a></div></div></div><div id="disqus_thread" class="gt-c-content-color-first"></div><script>var disqus_options={shortname:"baoshuo",api:"https://baoshuo.ren/api/disqus/",apikey:"SysuSvnZJi7nYvWwH14fu42b1CowDBsAH3Ol3UIsqdRbEcQwGFpWuUPkcX93ffCJ",identifier:location.pathname,title:"洛谷爬虫",siteName:"宝硕博客",admin:"renbaoshuo"}</script><script defer src="https://cdn.jsdelivr.net/gh/renbaoshuo/blog/scripts/disqus.lazyload.min.js"></script></div><div class="site-footer gt-c-content-color-first"><div class="footer-main"><span style="text-align:right;float:right">Theme <a href="https://github.com/renbaoshuo/hexo-theme-pure" target="_blank">Pure</a> | Powered by <a href="https://hexo.io" target="_blank">Hexo</a></span><span style="text-align:left"><a href="/atom.xml" target="_blank">RSS</a> | <a target="_blank" href="https://beian.miit.gov.cn">冀ICP备15024669号</a> | <a target="_blank" href="https://twitter.com/renbaoshuo">Twitter @renbaoshuo</a></span></div></div><script async src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js"></script></div></div></body></html>